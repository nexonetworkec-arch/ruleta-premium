<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NEXO® FORGE - Enterprise Edition</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <style>
        :root { 
            --bg-deep: #000000;
            --gold-bright: #fdf2cf;
            --gold-forge: #c5a059;
            --gold-deep: #7a5c2f;
            --cyan-glow: #00f2ff;
            --card-bg: rgba(5, 5, 5, 0.98);
        }

        /* REGLAS MAESTRAS: ORO Y MAYÚSCULAS */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        input, select, h1, h2, h3, .btn, #winnerName, .dynamic-title, .status-msg {
            color: var(--gold-forge) !important; text-transform: uppercase; letter-spacing: 2px; font-weight: 900;
        }

        input[type="email"], input[type="password"] { text-transform: none !important; letter-spacing: 1px; font-weight: 400; }

        body { 
            background-color: var(--bg-deep); color: var(--gold-forge); font-family: 'Segoe UI', sans-serif; 
            margin: 0; height: 100vh; overflow: hidden; display: flex; align-items: center; justify-content: center;
        }
        body::before { content: ''; position: absolute; inset: 0; background: radial-gradient(circle at center, #0d1b1e 0%, #000 100%); z-index: -1; }

        #loading-overlay { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }

        .screen { display: none; width: 100%; height: 100%; align-items: center; justify-content: center; flex-direction: column; z-index: 10; padding: 20px; }
        
        input { background: #000; border: 1px solid #222; border-radius: 15px; padding: 18px; text-align: center; font-size: 16px; margin-bottom: 15px; width: min(400px, 100%); }
        .btn { padding: 18px 40px; border: none; border-radius: 50px; cursor: pointer; transition: 0.4s; font-size: 12px; width: min(400px, 100%); }
        .btn-primary { background: linear-gradient(to bottom, var(--gold-bright), var(--gold-forge)); color: #000 !important; }

        /* RULETA */
        .wheel-outer-frame {
            position: relative; width: min(85vw, 550px); height: min(85vw, 550px);
            border-radius: 50%; background: #000; padding: 10px;
            box-shadow: 0 0 80px rgba(0, 242, 255, 0.1), 0 0 0 6px var(--gold-forge);
            display: flex; align-items: center; justify-content: center;
        }
        #btnSpinCenter { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--gold-forge); background: #000; z-index: 100; cursor: pointer; }
    </style>
</head>
<body>

    <div id="loading-overlay">
        <div style="width: 40px; height: 40px; border: 3px solid rgba(197,160,89,0.1); border-radius: 50%; border-top-color: var(--gold-forge); animation: spin 0.8s linear infinite;"></div>
        <p style="margin-top: 20px; font-weight: 900; font-size: 10px; letter-spacing: 5px;">NEXO® SECURE LOAD</p>
    </div>

    <div id="loginScreen" class="screen">
        <h2 style="font-size: 2rem; margin-bottom: 30px;">NEXO® LOGIN</h2>
        <input type="email" id="authEmail" placeholder="EMAIL">
        <input type="password" id="authPin" placeholder="PASSWORD">
        <button id="btnAuth" class="btn btn-primary">ENTRAR</button>
    </div>

    <div id="activationScreen" class="screen">
        <h2 style="font-size: 1.5rem; margin-bottom: 10px;">LICENCIA REQUERIDA</h2>
        <p style="font-size: 10px; margin-bottom: 30px; color: #ff4444 !important;">SU PERIODO FREE HA TERMINADO</p>
        <input type="text" id="licenseKeyInput" placeholder="INTRODUZCA CÓDIGO PREMIUM">
        <button id="btnActivate" class="btn btn-primary">ACTIVAR LICENCIA</button>
    </div>

    <div id="appMain" class="screen">
        <div id="adminBadge" style="display:none; color: var(--cyan-glow); font-size: 10px; margin-bottom: 10px;">MODO ADMINISTRADOR ACTIVO</div>
        <h1 class="dynamic-title" style="color: #fff !important; margin-bottom:20px;"></h1>
        <div class="wheel-outer-frame">
            <button id="btnSpinCenter">GIRAR</button>
            <canvas id="wheelCanvas" width="1000" height="1000" style="width:100%; height:100%;"></canvas>
        </div>
        <p id="trialTimer" style="margin-top: 20px; font-size: 10px;"></p>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCG703rpW4_8U2onJFSw7VfWDNLFofCk8A",
            authDomain: "ruletapremiumbusiness-4db7e.firebaseapp.com",
            projectId: "ruletapremiumbusiness-4db7e",
            storageBucket: "ruletapremiumbusiness-4db7e.firebasestorage.app",
            messagingSenderId: "822563863112",
            appId: "1:822563863112:web:d134d015736e2fafb5367d",
            databaseURL: "https://ruletapremiumbusiness-4db7e-default-rtdb.firebaseio.com"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(); const db = firebase.database();

        let config = { tituloSorteo: "NEXO FORGE", prizes: ["Premio 1", "Premio 2", "Premio 3"] };
        const ADMIN_EMAIL = "admin@nexo.com"; // Define tu email aquí

        function validateAccess(userData, user) {
            const now = Date.now();
            const is_admin = user.email === ADMIN_EMAIL;
            
            if (is_admin) {
                document.getElementById('adminBadge').style.display = 'block';
                showScreen('appMain');
                return;
            }

            // Lógica Free 24h
            if (!userData || !userData.expiryDate) {
                const expiry = now + (24 * 60 * 60 * 1000); // 24h desde ahora
                db.ref(`users/${user.uid}/config`).update({ 
                    expiryDate: expiry, 
                    licenseType: 'FREE',
                    licenseActive: true 
                });
                showScreen('appMain');
            } else if (now > userData.expiryDate && !userData.isPremium) {
                showScreen('activationScreen');
            } else {
                showScreen('appMain');
                const timeLeft = Math.round((userData.expiryDate - now) / 3600000);
                document.getElementById('trialTimer').innerText = `TIEMPO FREE RESTANTE: ${timeLeft} HORAS`;
            }
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'flex';
        }

        auth.onAuthStateChanged(user => {
            if(user) {
                db.ref(`users/${user.uid}/config`).on('value', snap => {
                    const data = snap.val();
                    if(data) config = {...config, ...data};
                    validateAccess(data, user);
                    document.querySelectorAll('.dynamic-title').forEach(el => el.innerText = config.tituloSorteo);
                    appWheel.draw();
                });
            } else {
                showScreen('loginScreen');
            }
            document.getElementById('loading-overlay').style.display = 'none';
        });

        // El motor de la ruleta se mantiene idéntico (v2.0) para integridad
        class Wheel {
            constructor() { this.canvas = document.getElementById('wheelCanvas'); this.ctx = this.canvas.getContext('2d'); this.angle = 0; }
            draw() {
                const cx = 500, cy = 500, r = 480, n = config.prizes.length, slice = (Math.PI*2)/n;
                this.ctx.clearRect(0,0,1000,1000);
                config.prizes.forEach((p, i) => {
                    this.ctx.save(); this.ctx.beginPath(); this.ctx.moveTo(cx,cy);
                    let grad = this.ctx.createRadialGradient(cx, cy, 100, cx, cy, r);
                    if (n % 2 !== 0 && i === n - 1) { grad.addColorStop(0, '#6A571B'); grad.addColorStop(1, '#332a0d'); }
                    else if(i % 2 === 0) { grad.addColorStop(0, '#c5a059'); grad.addColorStop(0.5, '#7a5c2f'); grad.addColorStop(1, '#fdf2cf'); }
                    else { grad.addColorStop(0, '#1a1a1a'); grad.addColorStop(1, '#000'); }
                    this.ctx.fillStyle = grad; this.ctx.arc(cx, cy, r, this.angle+i*slice, this.angle+(i+1)*slice); this.ctx.fill();
                    this.ctx.translate(cx,cy); this.ctx.rotate(this.angle+i*slice+slice/2);
                    this.ctx.textAlign="right"; this.ctx.font = "900 35px Segoe UI";
                    this.ctx.fillStyle = (n % 2 !== 0 && i === n - 1) ? "#fdf2cf" : (i % 2 === 0 ? "#000" : "#c5a059");
                    this.ctx.fillText(p.toUpperCase(), r-60, 12); this.ctx.restore();
                });
            }
        }
        const appWheel = new Wheel();

        document.getElementById('btnAuth').onclick = () => {
            auth.signInWithEmailAndPassword(document.getElementById('authEmail').value, document.getElementById('authPin').value);
        };
    </script>
</body>
</html>
