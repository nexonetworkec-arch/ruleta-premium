<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NEXO¬Æ Business Pro - Sistema de Sorteo Premium</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root { 
            --bg-color: #0a0a0a;
            --card-bg: #161616; 
            --gold: #d4af37; 
            --white: #ffffff; 
            --danger: #ff4d4d; 
            --gray: #222;
        }
        
        * { box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; outline: none; }
        
        body { 
            font-family: 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--white);
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--gray);
            padding-bottom: 10px;
        }

        header h1 {
            color: var(--gold);
            font-size: 1.8rem;
            margin: 0;
            letter-spacing: 2px;
        }

        .main-content {
            display: flex;
            flex: 1;
            gap: 20px;
            align-items: center;
        }

        .wheel-container {
            flex: 1.5;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        canvas#wheel {
            max-width: 100%;
            height: auto;
            filter: drop-shadow(0 0 15px rgba(0,0,0,0.5));
        }

        .controls {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .setup-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--gray);
        }

        .setup-item {
            margin-bottom: 15px;
        }

        .setup-item label {
            display: block;
            margin-bottom: 8px;
            color: var(--gold);
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .setup-item input[type="text"],
        .setup-item input[type="number"] {
            width: 100%;
            background: #0a0a0a;
            border: 1px solid #333;
            color: white;
            padding: 10px;
            border-radius: 6px;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 10px;
            background: #222;
            border-radius: 6px;
            margin-top: 10px;
        }

        .btn {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-gold {
            background: linear-gradient(45deg, #d4af37, #f1d592);
            color: black;
        }

        .btn-gold:hover { transform: scale(1.02); box-shadow: 0 0 15px rgba(212,175,55,0.4); }

        .btn-danger {
            background: transparent;
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .btn-danger:hover { background: var(--danger); color: white; }

        /* MODIFICACI√ìN M√ìVIL RECTIFICADA */
        @media (max-width: 800px) {
            body { overflow: hidden !important; position: fixed; width: 100%; }

            header {
                padding: 10px !important;
                margin-bottom: 5px !important;
                border: none !important;
            }

            header h1 {
                font-size: 1.1rem !important;
                width: 60% !important;
            }

            .app-container {
                padding: 10px !important;
                justify-content: flex-start !important;
            }

            .main-content {
                flex-direction: column !important;
                gap: 10px !important;
                justify-content: flex-start !important;
            }

            /* BOTONES ARRIBA A LA DERECHA */
            .controls {
                position: fixed !important;
                top: 10px !important;
                right: 10px !important;
                left: auto !important;
                bottom: auto !important;
                flex-direction: row !important;
                gap: 8px !important;
                z-index: 10001 !important;
                width: auto !important;
                background: transparent !important;
            }

            .btn {
                padding: 8px 12px !important;
                font-size: 11px !important;
                width: auto !important;
                min-width: 70px !important;
                height: 35px !important;
            }

            /* AJUSTE DE RULETA PARA DAR ESPACIO */
            .wheel-container {
                max-height: 45vh !important;
                transform: scale(0.85) !important;
                margin: 10px auto !important;
            }

            canvas#wheel {
                max-height: 40vh !important;
            }

            /* VISIBILIDAD DE CONFIGURACI√ìN */
            .setup-container {
                display: block !important;
                padding: 12px !important;
                margin-top: 5px !important;
                width: 100% !important;
            }
        }

        /* DISE√ëO PARA MEN√ö LATERAL */
        #nexoSideMenu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 280px;
            height: 100vh;
            background: #111;
            z-index: 10002;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 1px solid var(--gold);
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto !important; /* ACTIVADO: Scroll vertical */
            -webkit-overflow-scrolling: touch;
        }

        #nexoSideMenu.active { right: 0; }

        #nexoMenuOverlay {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.8);
            z-index: 10001;
            display: none;
            backdrop-filter: blur(5px);
        }

        #nexoMenuOverlay.active { display: block; }

        .menu-header {
            color: var(--gold);
            font-size: 1.2rem;
            font-weight: bold;
            padding-bottom: 20px;
            border-bottom: 1px solid #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-option-item {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            background: #1a1a1a;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.9rem;
        }

        .menu-option-item:hover { background: #222; color: var(--gold); }
        .menu-logout { color: var(--danger); margin-top: auto; border: 1px solid rgba(255,77,77,0.2); }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <h1 id="appTitle">NEXO¬Æ SORTEO</h1>
    </header>

    <div class="main-content">
        <div class="wheel-container">
            <canvas id="wheel" width="600" height="600"></canvas>
        </div>

        <div class="controls">
            <button class="btn btn-gold" id="spinBtn">üé∞ GIRAR RULETA</button>
            <button class="btn btn-danger" id="resetBtn">üîÑ REINICIAR</button>
            
            <div class="setup-container">
                <div class="setup-item">
                    <label>T√≠tulo Personalizado</label>
                    <input type="text" id="titleInput" placeholder="NEXO¬Æ SORTEO">
                </div>
                <div class="setup-item">
                    <label>Participantes (Separados por coma)</label>
                    <input type="text" id="namesInput" placeholder="Pedro, Ana, Juan...">
                </div>
                <label class="checkbox-container">
                    <input type="checkbox" id="autoDelete" checked>
                    <span>Auto-eliminar Ganador</span>
                </label>
            </div>
        </div>
    </div>
</div>

<script>
    // --- MOTOR DE RULETA Y FIREBASE (RESTO DEL C√ìDIGO ORIGINAL) ---
    const config = {
        apiKey: "AIzaSyB...",
        authDomain: "tu-proyecto.firebaseapp.com",
        databaseURL: "https://tu-proyecto.firebaseio.com",
        projectId: "tu-proyecto",
        storageBucket: "tu-proyecto.appspot.com",
        messagingSenderId: "123",
        appId: "1:123:web:abc"
    };

    firebase.initializeApp(config);
    const auth = firebase.auth();
    const db = firebase.database();

    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const spinBtn = document.getElementById('spinBtn');
    const resetBtn = document.getElementById('resetBtn');
    const titleInput = document.getElementById('titleInput');
    const namesInput = document.getElementById('namesInput');
    const autoDelete = document.getElementById('autoDelete');
    const appTitle = document.getElementById('appTitle');

    let segments = [];
    let currentRotation = 0;
    let isSpinning = false;

    function drawWheel() {
        const radius = canvas.width / 2;
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (segments.length === 0) {
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius - 10, 0, 2 * Math.PI);
            ctx.fillStyle = '#1a1a1a';
            ctx.fill();
            ctx.strokeStyle = '#d4af37';
            ctx.lineWidth = 5;
            ctx.stroke();
            return;
        }

        const sliceAngle = (2 * Math.PI) / segments.length;

        segments.forEach((name, i) => {
            const angle = currentRotation + (i * sliceAngle);
            
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius - 10, angle, angle + sliceAngle);
            ctx.fillStyle = i % 2 === 0 ? '#161616' : '#111';
            ctx.fill();
            ctx.strokeStyle = '#d4af37';
            ctx.stroke();

            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(angle + sliceAngle / 2);
            ctx.textAlign = "right";
            ctx.fillStyle = "white";
            ctx.font = "bold 20px Segoe UI";
            ctx.fillText(name.substring(0, 15), radius - 40, 10);
            ctx.restore();
        });

        // Marcador superior
        ctx.beginPath();
        ctx.moveTo(centerX + 20, 0);
        ctx.lineTo(centerX - 20, 0);
        ctx.lineTo(centerX, 40);
        ctx.fillStyle = '#d4af37';
        ctx.fill();
    }

    function updateSegments() {
        const input = namesInput.value;
        segments = input.split(',').map(s => s.trim()).filter(s => s !== "");
        drawWheel();
    }

    namesInput.addEventListener('input', updateSegments);
    titleInput.addEventListener('input', () => appTitle.innerText = titleInput.value || "NEXO¬Æ SORTEO");

    spinBtn.onclick = () => {
        if (isSpinning || segments.length < 2) return;
        isSpinning = true;
        
        const extraSpins = 5 + Math.random() * 5;
        const totalRotation = extraSpins * 2 * Math.PI;
        const duration = 4000;
        const start = performance.now();

        function animate(time) {
            const elapsed = time - start;
            const progress = Math.min(elapsed / duration, 1);
            const easeOut = 1 - Math.pow(1 - progress, 3);
            
            currentRotation = easeOut * totalRotation;
            drawWheel();

            if (progress < 1) {
                requestAnimationFrame(animate);
            } else {
                isSpinning = false;
                const sliceAngle = (2 * Math.PI) / segments.length;
                const normalizedRotation = (2 * Math.PI) - (currentRotation % (2 * Math.PI));
                const winnerIndex = Math.floor(normalizedRotation / sliceAngle);
                const winner = segments[winnerIndex];
                
                alert("üèÜ GANADOR: " + winner);
                
                if (autoDelete.checked) {
                    segments.splice(winnerIndex, 1);
                    namesInput.value = segments.join(', ');
                    drawWheel();
                }
            }
        }
        requestAnimationFrame(animate);
    };

    resetBtn.onclick = () => {
        if (confirm("¬øReiniciar sorteo?")) {
            namesInput.value = "";
            segments = [];
            currentRotation = 0;
            drawWheel();
        }
    };

    drawWheel();

    // --- INYECCI√ìN DE INTERFAZ PREMIUM (SIDE MENU) ---
    const menuBtn = document.createElement('div');
    menuBtn.id = 'nexoMenuBtn';
    menuBtn.innerHTML = '‚ò∞';
    menuBtn.style.cssText = `
        position: fixed; top: 12px; left: 15px; width: 40px; height: 40px;
        background: #111; color: #d4af37; border: 1px solid #d4af37;
        border-radius: 8px; display: flex; align-items: center; justify-content: center;
        font-size: 20px; cursor: pointer; z-index: 10003;
    `;

    const sideMenu = document.createElement('div');
    sideMenu.id = 'nexoSideMenu';
    sideMenu.innerHTML = `
        <div class="menu-header">üíé NEXO¬Æ Business Pro</div>
        <div class="menu-options">
            <div class="menu-option-item" onclick="alert('Historial pr√≥ximamente')">üìú Historial de Ganadores</div>
            <div class="menu-option-item" onclick="alert('Base de Datos Conectada')">‚òÅÔ∏è Firebase Status: OK</div>
            <div class="menu-option-item" onclick="location.reload()">üîÑ Actualizar App</div>
            <div class="menu-option-item menu-logout" onclick="auth.signOut()">üö™ Cerrar Sesi√≥n</div>
        </div>
    `;

    const overlay = document.createElement('div');
    overlay.id = 'nexoMenuOverlay';

    document.body.appendChild(menuBtn);
    document.body.appendChild(sideMenu);
    document.body.appendChild(overlay);

    const closeAll = () => {
        sideMenu.classList.remove('active');
        overlay.classList.remove('active');
    };

    menuBtn.onclick = () => {
        sideMenu.classList.toggle('active');
        overlay.classList.toggle('active');
    };
    overlay.onclick = closeAll;

    const performInterfaceCleanup = () => {
        const targets = ["SALIR", "CONFIGURACI√ìN DE MARCA"];
        document.querySelectorAll('button, .btn').forEach(btn => {
            if (targets.some(t => btn.innerText.toUpperCase().includes(t))) {
                btn.style.setProperty('display', 'none', 'important');
            }
        });
    };

    auth.onAuthStateChanged((user) => {
        if (user) {
            menuBtn.style.display = 'flex';
            setTimeout(performInterfaceCleanup, 500);
        }
    });

})(); // CIERRE FINAL
</script>
</body>
</html>
